	/**
	  *	@fileOverView user model  
	*/

	var base = require('./base');
	var sql_get = 'SELECT * FROM ubac_permission',
		sql_get_by_role = 'SELECT p.* FROM ubac_permission AS p, ubac_permission_role AS pr WHERE pr.permission_id=p.id AND pr.role_id=?;',
		sql_get_by_user = 'SELECT p.* FROM ubac_permission AS p, ubac_permission_role AS pr WHERE pr.permission_id=p.id AND pr.role_id in (SELECT role_id FROM ubac_role_user WHERE user_id=?);',
		sql_add = 'INSERT INTO ubac_permission SET ?',
		sql_set = 'UPDATE ubac_permission SET ? WHERE ?',
		sql_del = 'DELETE FROM ubac_permission WHERE id=?',
		sql_del_permission_role = 'DELETE FROM ubac_permission_role WHERE permission_id=?',
		sql_assign_permission = 'INSERT INTO ubac_permission_role SET ?',
		sql_remove_permission = 'DELETE FROM ubac_permission_role WHERE role_id=? AND permission_id=?';
	
	
	
	
	/**
	  *	@desp 添加一个新的权限
	*/
	var add = function(permissionInfo){
		return base.excute(sql_add, permissionInfo);
	};
	
	
	
	/**
	  *	@desp 获取权限,判断传入参数类型，返回对应结果
	  * 若无参数则返回所有权限
	*/
	var get = function(query){
		
		if(query && query.user_id)
			return base.excute(sql_get_by_user, query.user_id);
		if(query && query.role_id)
			return base.excute(sql_get_by_role, query.role_id);
		
		return base.excute(sql_get);
	};
	


	
	
	/**
	  *	@desp 修改权限信息
	*/
	var set = function(permissionInfo, query){
		return base.excute(sql_set, [permissionInfo, query]);
	};
	
	
	
	/**
	  *	@desp 删除用户
	*/
	var del = function(query){
		var permission_id = query.id;
		return q.all([
			base.excute(sql_del, permission_id),
			base.excute(sql_del_permission_role, permission_id)
		]);
	};
	
	
	
	/**
	  *	@desp 分配权限到角色
	*/
	var assign = function(role_id, permission_id){
		var info = {"role_id":role_id, "permission_id":permission_id};
		return base.excute(sql_assign_permission, info);
	};
	
	
	
	/**
	  *	@desp 移除角色权限
	*/
	var remove = function(role_id, permission_id){
		return base.excute(sql_remove_permission, [role_id, permission_id]);
	};
	
	exports.add = add;
	exports.get = get;
	exports.set = set;
	exports.del = del;
	exports.assign = assign;
	exports.remove = remove;