	/**
	  *	@fileOverView user model  
	*/
	
	var base = require('./base');
	var q = require('q');

	
	var sql_add = 'INSERT INTO ubac_role SET ?',
		sql_get = 'SELECT * FROM ubac_role',
		sql_get_by_user = 'SELECT b.* FROM ubac_role_user as a, ubac_role as b WHERE a.role_id=b.id and a.user_id in (?);',
		sql_set = 'UPDATE ubac_role SET ? WHERE ?',
		sql_del = 'DELETE FROM ubac_role WHERE id in (?)',
		sql_del_role_user = 'DELETE FROM ubac_role_user WHERE role_id in (?)';
		sql_assign_role = 'INSERT INTO ubac_role_user SET ?';
		sql_remove_role = 'DELETE FROM ubac_role_user WHERE user_id=? AND role_id=?';
	
	
	/**
	  *	@desp 添加角色
	*/
	var add = function(roleInfo){
		return base.excute(sql_add, roleInfo);
	};
	
	
	/**
	  *	@desp 获取所有角色及其权限
	*/
	var get = function(query){
		
		if(query && query.user_id)
			return base.excute(sql_get_by_user, query.user_id);

		return base.excute(sql_get, query);
	};
	
	
	
	
	
	/**
	  *	@desp 添加角色
	*/
	var set = function(roleInfo, query){
		return base.excute(sql_set,  [roleInfo, query]);
	};
	
	
	
	/**
	  *	@desp 添加角色
	*/
	var del = function(query){
		var role_id = query.id;
		return q.all([
			base.excute(sql_del, role_id),
			base.excute(sql_del_role_user, role_id)
		]);
	};
	
	
	
	/**
	  *	@desp 给用户分配角色
	*/
	var assign = function(user_id, role_id){
		var info = {"user_id":user_id, "role_id":role_id};
		return base.excute(sql_assign_role, info);
	};
	
	
	
	/**
	  *	@desp 移除用户角色
	*/
	var remove = function(user_id, role_id){
		return base.excute(sql_remove_role, [user_id, role_id]);
	};
	
	
	
	exports.add = add;
	exports.get = get;
	exports.set = set;
	exports.del = del;
	exports.assign = assign;
	exports.remove = remove;